define(["jquery","components","common","template"],function(e,t,o,n){function i(e,o,n){if(1!=m){m=!0;var i="one_edit_"+o,d="one_sub_"+o;1==n&&(i="edit_"+o,d="sub_"+o);var s=$("#"+i).val();s=parseInt(s),(isNaN(s)||s<0)&&(s=0),1==e?s=parseInt(s)+parseInt(1):2==e&&(s=parseInt(s)-parseInt(1)),s>1e4&&(s=1e4);var a=apiUrl+"/front/shoppingcart/shoppingcart/editNumeberToShoppingCart?priceId="+o+"&quantity="+s;t.getMsg(a).done(function(e){m=!1,l();var t=e.res;1==t?(0==s?(document.getElementById(d).style.display="none",document.getElementById(i).style.display="none"):(document.getElementById(d).style.display="block",document.getElementById(i).style.display="block"),$("#"+i).val(s)):alert("直接修改数量操作失败！")})}}function d(e,t){i(e,t,0)}function s(e){i(2,e,1)}function a(e){i(1,e,1)}function r(e){i(3,e,1)}function c(e){var o="show_goods_price_list_"+e,i=document.getElementById(o).style.display;if("none"==i){var d=apiUrl+"/front/goodsPrice/goodsPrice/getGoodsPriceListByGoodsId?goodsId="+e;t.getMsg(d).done(function(t){var i=t.res;if(1==i){for(var d=t.obj,c=0;c<d.length;c++)d[c].retailPrice=d[c].retailPrice/100;t.goodspriceDataList=d;var l=n("show_goods_price_list-tpl",t);$("#"+o).html(l);var g="goodsId_"+e;document.getElementById(g).innerHTML="收起",document.getElementById(o).style.display="";for(var u in d){var m=new Object;m=d[u].priceId,$("#edit_"+m).val(d[u].buyPrice),$("#sub_"+m).click(function(){s(this.id.substring(4))}),$("#add_"+m).click(function(){a(this.id.substring(4))}),$("#edit_"+m).change(function(){r(this.id.substring(5))}),0==d[u].buyPrice&&(document.getElementById("sub_"+m).style.display="none",document.getElementById("edit_"+m).style.display="none")}}else alert("获取产品规格失败！")})}else{document.getElementById(o).style.display="none";var c="goodsId_"+e;document.getElementById(c).innerHTML="选择规格"}}function l(){var e=apiUrl+"/front/shoppingcart/shoppingcart/queryCurrentUserTotalPriceAndCategory";t.getMsg(e).done(function(e){var t=e.res;if(1==t){var o=e.obj;document.getElementById("totalNumber").innerHTML=o.totalPrice/100*1,document.getElementById("totalCategory").innerHTML=o.totalCategory,g()}else alert("获取总价失败！")})}function g(){var e=document.getElementById("totalNumber").innerHTML,t=(100*settleAccountsPrice-100*e)/100;t<=0?(document.getElementById("settle_accounts").innerHTML="结算",document.getElementById("settle_accounts").style.backgroundColor="#2CC17B",document.getElementById("settle_accounts").setAttribute("href","/pages/bdshop/page/order_submit.html"),document.getElementById("settle_accounts").style.fontSize="18px"):(document.getElementById("settle_accounts").innerHTML="还差"+t,document.getElementById("settle_accounts").removeAttribute("href"),document.getElementById("settle_accounts").style.backgroundColor="#EEEAFA",document.getElementById("settle_accounts").style.fontSize="12px")}var u=apiUrlPic,m=!1,p=$("#show_goods_list_search"),y=$("#noRec"),_=$("#cloading"),h="",I={page:0,size:10,isLoading:!1,url:apiUrl+"/front/goods/goods/getPageFrontByMyStoreGoods",getMore:function(e,t){I.isLoading||(e?(I.page=1,$("#noRec").hide(),p.html("")):I.page+=1,$("#cloading").show(),I.isLoading=!0,setTimeout(I.d(I.page,I.size,t),1e3))},d:function(e,t,o){$.ajax({url:I.url,data:"pageNo="+e+"&pageSize="+t,type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json"}).done(function(e){var t=e.res;if(0!==t){var o=e.obj.dataList;e=e.obj,e.goodsDataList=o;for(var i=0;i<e.goodsDataList.length;i++)if(""!==e.goodsDataList[i].image){e.goodsDataList[i].image=e.goodsDataList[i].image.split(",");for(var s=0;s<e.goodsDataList[i].image.length;s++)e.goodsDataList[i].image[s]=u+e.goodsDataList[i].image[s];e.goodsDataList[i].vo_retailPrice=e.goodsDataList[i].vo_retailPrice/100}var a=n("show_goods_list_search-tp",e);o&&o.length>0?(I.isLoading=!1,y.hide()):(I.isLoading=!0,y.hide()),I.page>1?p.append(a):p.html(a),_.hide();for(var r in o){var l=new Object;l="goodsId_"+o[r].goodsId,$("#"+l).click(function(){c(this.id.substring(8))}),$("#one_edit_"+o[r].vo_priceId).val(o[r].vo_shoppingCartNum),$("#one_sub_"+o[r].vo_priceId).click(function(){d(2,this.id.substring(8))}),$("#one_add_"+o[r].vo_priceId).click(function(){d(1,this.id.substring(8))}),$("#one_edit_"+o[r].vo_priceId).change(function(){d(3,this.id.substring(9))}),1==o[r].vo_countGoodsPrice&&(document.getElementById("goodsId_"+o[r].goodsId).style.display="none",0==o[r].vo_shoppingCartNum?document.getElementById("one_add_"+o[r].vo_priceId).style.display="block":(document.getElementById("one_sub_"+o[r].vo_priceId).style.display="block",document.getElementById("one_edit_"+o[r].vo_priceId).style.display="block",document.getElementById("one_add_"+o[r].vo_priceId).style.display="block"))}void 0!=e.goodsDataList&&e.goodsDataList.length>0?$("#firstLoadNodata").hide():void 0==e.goodsDataList&&1==I.page&&$("#firstLoadNodata").show()}else y.hide(),_.hide()})}};$(window).scroll(function(){$(document).scrollTop()+$(window).height()+100>=$(document).height()&&(I.getMore(!1,h),y.hide())}),l(),I.getMore(!0,h)});