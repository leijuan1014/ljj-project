define(["components","common","template"],function(e,t,i){function o(e){d(2,e,1)}function a(e,t){d(e,t,0)}function n(e){d(1,e,1)}function s(){var t=u+"/front/shoppingcart/shoppingcart/queryCurrentUserTotalPriceAndCategory";e.getMsg(t).done(function(e){var t=e.res;if(1==t){e.obj}else alert("获取总价失败！")})}function d(t,i,o){if(1!=h){h=!0;var a="one_edit_"+i,n="one_sub_"+i;1==o&&(a="edit_"+i,n="sub_"+i);var d=$("#"+a).val();d=parseInt(d),(isNaN(d)||d<0)&&(d=0),1==t?d=parseInt(d)+parseInt(1):2==t&&(d=parseInt(d)-parseInt(1)),d>1e4&&(d=1e4);var r=u+"/front/shoppingcart/shoppingcart/editNumeberToShoppingCart?priceId="+i+"&quantity="+d;e.getMsg(r).done(function(e){h=!1,s();var t=e.res;1==t?(0==d?(document.getElementById(n).style.display="none",document.getElementById(a).style.display="none"):(document.getElementById(n).style.display="block",document.getElementById(a).style.display="block"),$("#"+a).val(d)):alert("直接修改数量操作失败！")})}}function r(t){var a="show_goods_price_list_"+t,s=document.getElementById(a).style.display;if("none"==s){var d=u+"/front/goodsPrice/goodsPrice/getGoodsPriceListByGoodsId?goodsId="+t;e.getMsg(d).done(function(e){var s=e.res,d=e.obj;if(1===s&&d){for(var r=0;r<d.length;r++)d[r].retailPrice=d[r].retailPrice/100;e.goodspriceDataList=d;var l=i("show_goods_price_list-tpl",e);$("#"+a).html(l);var c="goodsId_"+t;document.getElementById(c).innerHTML="收起",document.getElementById(a).style.display="";for(var g in d){var u=new Object;u=d[g].priceId,$("#edit_"+u).val(d[g].buyPrice),$("#sub_"+u).click(function(){o(this.id.substring(4))}),$("#add_"+u).click(function(){n(this.id.substring(4))}),$("#edit_"+u).change(function(){editNumeberToShoppingCart(this.id.substring(5))}),0==d[g].buyPrice&&(document.getElementById("sub_"+u).style.display="none",document.getElementById("edit_"+u).style.display="none")}}else alert("获取产品规格失败！")})}else{document.getElementById(a).style.display="none";var r="goodsId_"+t;document.getElementById(r).innerHTML="选择规格"}}function l(){var e=u+"/front/article/article/getArticleByPage";$.ajax({url:e,data:"pageNo=1 &pageSize=2",type:"GET",crossDomain:!0,dataType:"json",xhrFields:{withCredentials:!0}}).done(function(e){if(res=e.res,1===res&&(e=e.obj,0!==e.dataList.length)){var t=(e.dataList,i("article_list_tp",e));$("#article_list").html(t)}})}function c(){var e=u+"/front/ad/ad/getAdByPage";$.ajax({url:e,data:"pageNo=1 &pageSize=5",type:"GET",crossDomain:!0,dataType:"json"}).done(function(e){if(res=e.res,1==res){e=e.obj;for(var t="",i=0;i<e.dataList.length;i++)e.dataList[i].image.length>0&&(t+='<li><a class="pic" href="'+e.dataList[i].url+'"><img src="'+p+e.dataList[i].image+'"></a></li>');$("#ad_list").html(t),TouchSlide({slideCell:"#slideBox",titCell:".hd ul",mainCell:".bd ul",effect:"leftLoop",autoPage:!0,autoPlay:!0,interTime:5e3});var o=$("#slideBox .hd").width();$("#slideBox .hd").css("margin-left",-.5*o)}})}function g(){var e=u+"/front/message/message/getMessageLevel";$.ajax({url:e,data:"",type:"GET",crossDomain:!0,dataType:"json",xhrFields:{withCredentials:!0}}).done(function(t){function o(e){$(e).find("ul").animate({marginTop:"-1.5rem"},500,function(){$(this).css({marginTop:"0rem"}).find("li:first").appendTo(this)})}var a=t.res;if(1==a){var n=i("msg_list_tpl",t);$("#msg_list").html(n);var s=$("#msg_list").find("li").length;if(s>1){var d=setInterval(function(){o(".notice_active")},3500);$(".notice_active").mousemove(function(){clearInterval(d)}).mouseout(function(){d=setInterval('timer(".notice_active")',3500)})}$("#msg_list").on("click",".send-modal",function(){var t=$(this).attr("url"),i=$(this).attr("userMsgId"),o=$(this).attr("id");e=t.length>0?t:"/pages/bdshop/page/stationMessageInfo.html?id="+o+"&userMessageId="+i,window.location.href=e})}})}e.addActiveClass(0);var u="http://192.168.1.103:8080/xiss",p="http://192.168.1.103:90/img/bdshop",m=$("#product-list"),f=$("#cloading"),h=!1,_={page:0,size:3,isLoading:!1,url:u+"/front/goods/goods/getPageFrontRecommendAndIsMarketableGoods",getMore:function(e){_.isLoading||(e?(_.page=1,$("#noRec").hide(),m.html("")):_.page+=1,$("#cloading").show(),_.isLoading=!0,setTimeout(_.d(_.page,_.size),1e3))},d:function(e,t){$.ajax({url:_.url,data:"pageNo="+e+"&pageSize="+t+"&categoryId=0",type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json"}).done(function(e){var t=e.res;if(0!==t){e=e.obj;for(var o=0;o<e.dataList.length;o++){if(""!==e.dataList[o].image){e.dataList[o].image=e.dataList[o].image.split(",");for(var n=0;n<e.dataList[o].image.length;n++)e.dataList[o].image[n]=p+e.dataList[o].image[n]}e.dataList[o].vo_retailPrice=e.dataList[o].vo_retailPrice/100}var s=e.dataList,d=i("product-list-tpl",e),l=e.dataList;s&&s.length>0?_.isLoading=!1:(_.isLoading=!0,$("#noRec")[0]&&$("#noRec").remove()),_.page>1?m.append(d):m.html(d),f.hide();for(var c in l){var g=new Object;g="goodsId_"+l[c].goodsId,$("#"+g).click(function(){r(this.id.substring(8))}),$("#one_edit_"+l[c].vo_priceId).val(l[c].vo_shoppingCartNum),$("#one_sub_"+l[c].vo_priceId).click(function(){a(2,this.id.substring(8))}),$("#one_add_"+l[c].vo_priceId).click(function(){a(1,this.id.substring(8))}),$("#one_edit_"+l[c].vo_priceId).change(function(){a(3,this.id.substring(9))}),1==l[c].vo_countGoodsPrice&&(document.getElementById("goodsId_"+l[c].goodsId).style.display="none",0==l[c].vo_shoppingCartNum?document.getElementById("one_add_"+l[c].vo_priceId).style.display="block":(document.getElementById("one_sub_"+l[c].vo_priceId).style.display="block",document.getElementById("one_edit_"+l[c].vo_priceId).style.display="block",document.getElementById("one_add_"+l[c].vo_priceId).style.display="block"))}}else{var u='<div class="weui-loadmore weui-loadmore_line hide" id="noRec"> <span class="weui-loadmore__tips">暂无数据</span> </div>';m.html(u),f.hide()}})}};l(),$(window).scroll(function(){$(document).scrollTop()+$(window).height()+100>=$(document).height()&&_.getMore(!1)}),_.getMore(!0),c(),g(),$(".weui-flex__item[data-type]").on("click",function(){var e=$(this).attr("data-type");window.location.href="/pages/bdshop/page/productList.html?categoryId="+e})});