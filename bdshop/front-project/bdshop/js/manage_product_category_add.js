define(["jquery","template","components","ZeroClipboard","jqueryValidate","ueditorConfig","ueditorAll","manageCommon"],function(e,a,t,o,i,d,r,s){function l(){var e=!1,a=!1,o=!1,i=!1,d=!1,r=!1;t.getMsg(apiUrl+"/admin/module/module/queryModules").done(function(t){if(1==t.res)for(var s=t.obj,l=0;l<s.length;l++){var n=s[l],c=n.moduleId;n.parentId;7==c&&($("#goodsList").css("display","block"),e=!0),8==c&&($("#goodsOrder").css("display","block"),e=!0),9==c&&($("#goodsCatory").css("display","block"),e=!0),10==c&&($("#memberManage").css("display","block"),a=!0),11==c&&($("#messageManage").css("display","block"),a=!0),12==c&&($("#articleManage").css("display","block"),o=!0),13==c&&($("#adManage").css("display","block"),i=!0),14==c&&($("#goodsReport").css("display","block"),d=!0),15==c&&($("#orderReport").css("display","block"),d=!0),16==c&&($("#adminManage").css("display","block"),r=!0),17==c&&($("#roleManage").css("display","block"),r=!0),e&&$("#div1").css("display","block"),a&&$("#div2").css("display","block"),o&&$("#div3").css("display","block"),i&&$("#div4").css("display","block"),d&&$("#div5").css("display","block"),r&&$("#div6").css("display","block"),(e||a||o&&i||d||r)&&$(".container-wrap").css("display","block")}})}function n(){$("#div-box").on("change","#pic-upload",function(){var e=new FormData;e.append("param",""),e.append("file",$("#pic-upload")[0].files[0]);var a=apiUrl+"/upload/uploadimg/dydz/user";$.ajax({url:a,type:"POST",dataType:"json",data:e,processData:!1,contentType:!1,success:function(e){var a='<li picUrl="'+e.result+'"class="apply-book"> <img  src=" '+apiUrlPic+e.result+'"> <a docUrl="'+e.result+'" href="javascript:void(0)" class="text-basic del-doc"><i class="iconfont icon-delete"></i></a></li>';$("#pic-document-list").append(a),v+=1,6==v&&$(".a-upload").css("display","none")}})})}function c(){$("#div-box").on("click",".del-doc",function(){var e=$(this),a=apiUrl+"/upload/removeFile",t=e.attr("picUrl");$.ajax({url:a,type:"get",dataType:"json",data:"preImg="+t,success:function(a){1==a.res&&(e.parents("li").remove(),v-=1,v<6&&$(".a-upload").css("display","block"))}})})}function p(e){var o=apiUrl+"/admin/productcategory/productcategory/getProductCategoryInfo?categoryId="+e;t.getMsg(o).done(function(e){var o=e.res;if(1==o){var i=a("div-box-tpl",e),d=a("div-box-tp2",e);if(0==t.GetQueryString("parentId")?document.getElementById("div-box").innerHTML=i:(m(e.obj.parentId),document.getElementById("div-box").innerHTML=d,document.getElementById("div-box-img").style.display="none"),""!=e.obj.image){var r=e.obj.image.split(",");v=r.length,6==v&&$(".a-upload").css("display","none");for(var s=0;s<r.length;s++){var l=apiUrlPic+r[s];$("#pic-document-list").append($('<li picUrl="'+r[s]+'"class="apply-book"> <img  src=" '+l+'"> <a docUrl="'+r[s]+'" href="javascript:void(0)" class="text-basic del-doc iconfont icon-close"></a></li>'))}}}})}function u(){$("#form-box").validate({rules:{categoryName:{required:!0,maxlength:30},state:{required:!0},recommend:{required:!0}},messages:{categoryName:{required:"商品分类名称必填",maxlength:"最多填写30个字符"},state:{required:"请选择一个"},recommend:{required:"请选择一个"}},submitHandler:function(e){$("#pic-document-list > li").each(function(){I+=$(this).attr("picUrl")+","});var a=/,$/gi;I=I.replace(a,"");var o=$("#form-box").serialize()+"&image="+I;t.getMsg(f,o,"post").done(function(e){1==e.res&&(t.Alert("success","修改成功"),setTimeout(function(){window.history.go(-1)},2e3))})}})}function g(e,o,i){var d=apiUrl+"/admin/productcategory/productcategory/getAllNormalChildCategoryByCategoryId?categoryId="+o;t.getMsg(d).done(function(t){var o=t.res;if(1==o){var d=t.obj;t.dataList=d;var r=a("levelCategoryDataList",t);r='<option  value="0">请选择分类</option>'+r,$("#"+e).html(r),i&&$("#"+e).val(i),$("#firstLevelList").on("change",function(){var e=document.getElementById("firstLevelList"),a=e.options[e.selectedIndex].value;y(a)})}})}function y(e){$("#parentId").val(e)}function m(e){e?g("firstLevelList",0,e):g("firstLevelList",0,0)}l(),window.ZeroClipboard=o;var v=0,b=t.GetQueryString("id"),f="",I="";if(b)f=apiUrl+"/admin/productcategory/productcategory/editProductCategory?categoryId="+b,p(b),$("#addState").text("编辑商品分类");else{var k=t.GetQueryString("parentId");void 0!=k&&0!=k?(document.getElementById("div-box-parentId").style.display="",document.getElementById("parentId").value=k,document.getElementById("div-box-img").style.display="none"):(document.getElementById("parentId").value=0,document.getElementById("div-box-parentId").style.display="none"),m(k),f=apiUrl+"/admin/productcategory/productcategory/addProductcategory",$("#addState").text("添加商品分类")}n(),c(),u(),jQuery.validator.addMethod("num",function(e,a){var t=/^(([1-9]+\d*)|(\d+(\.\d[1-9]))|(\d+(\.[1-9])))$/g;return this.optional(a)||t.test(e)},"请填写非负正数且最多保留小数点后两位 ")});