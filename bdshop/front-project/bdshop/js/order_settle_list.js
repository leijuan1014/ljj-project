define(["jquery","components","common","template","weui"],function(e,t,o,r,a){function i(e){var t=e.attr("Money");g=$("#total-money").text(),e.is(":checked")?(g=parseInt(100*g)+parseInt(100*t),u++):(g=parseInt(100*g)-parseInt(100*t),u--),g/=100,null!=g&&g>=1e4?($("#order_submit").text("超出支付金额"),$("#order_submit").css("background-color","#C6C6C6")):($("#order_submit").text("结算"),$("#order_submit").css("background-color","#2BC17A")),$("#total-money").text(g),$("#num").text(u)}function n(e){var t=new Date(e.replace(/\-/g,"/"));if(""==m&&""==p)m=e,p=e;else{var o=new Date(m.replace(/\-/g,"/")),r=new Date(p.replace(/\-/g,"/"));o>t?m=e:r<t&&(p=e)}}var s,d=$("#order-box"),l=$("#weui-loadmore"),c=$("#noRec"),g=0,u=0,m="",p="",h={page:0,size:15,isLoading:!1,url:apiUrl+"/front/order/order/getLJOrderByPage?pageSize=4",getMore:function(e){h.isLoading||(e?(h.page=1,$("#noRec").hide(),d.html("")):h.page+=1,l.show(),h.isLoading=!0,setTimeout(h.d(h.page,h.size),1e3))},d:function(e,t){$.ajax({url:h.url,data:"pageNo="+e+"&pageSize="+t,type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json"}).done(function(e){var t=e.res;if(0!==t){e=e.obj;for(var o=0;o<e.dataList.length;o++){e.dataList[o].goodsName=e.dataList[o].orderDetailsList[0].goodsName,e.dataList[o].totalAmount=e.dataList[o].totalAmount/100;for(var a=0;a<e.dataList[o].orderDetailsList.length;a++){console.log(e.dataList[o].orderDetailsList[a].image);var i,n=e.dataList[o].orderDetailsList[a].image;n.length>0&&(i=n.split(","),i.length>0&&(e.dataList[o].orderDetailsList[a].image=apiUrlPic+i[0]))}}var g=e.dataList,u=r("order-box-tpl",e);g&&g.length>0?(h.isLoading=!1,c.hide()):(h.isLoading=!0,c.show()),h.page>1?(d.append(u),s=$("#order-box .order-list")):(d.html(u),s=$("#order-box .order-list")),l.hide()}else c.show(),l.hide()})}};$(window).scroll(function(){var e=$(document).scrollTop()+$(window).height()+100,t=$(document).height();e>=t&&h.getMore(!1)}),h.getMore(!0),$("#order-box").on("click",".send-modal",function(){var e=$(this).attr("oNum");url=apiUrl+"/front/order/order/buyGoodsAgain?orderNumber="+e,t.getMsg(url).done(function(e){var t=e.res;1==t?window.location.href="/pages/bdshop/page/order_submit.html":$.toast("购买失败","text")})}),$("#order_submit").click(function(){if(!(null!=g&&g>=1e4)){if(g<=0)return void $.toast("请选择一个去付款","text");for(var e=apiUrl+"/front/order/order/joinOrder",o=document.getElementsByName("checkbox"),r="",a=0;a<o.length;a++)if(o[a].checked){0!=r.length&&(r+=","),r+=o[a].value;var i=$("#time_"+a).val();n(i)}var s={orderNumbers:r};t.getMsg(e,s,"post").done(function(e){var t=e.res;1==t?window.location.href="/pages/bdshop/page/pay_check_settle.html?orderNumber="+e.result+"&price="+g+"&startTime="+m+"&endTime="+p:$.toast("购买失败","text")})}}),$("#order-box").on("click",".chosen",function(){var e=$(this);i(e)}),$("#total-money").text(g),$("#num").text(u)});