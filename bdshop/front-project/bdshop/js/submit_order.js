define(["jquery","components","common","template","weui"],function(t,e,o,i,r){function a(){var t=apiUrl+"/front/order/order/doOrder?goodsIds="+d;e.getMsg(t).done(function(t){var o=t.res;if(1==o){t=t.obj,p=t.receiveState,g=t.allGoods[0].goodsName,h=t.allGoods[0].price/100,t.allGoods[0].price=t.allGoods[0].price/100,t.allGoods[0].image=t.allGoods[0].image.split(",");for(var r=0;r<t.allGoods[0].image.length;r++)t.allGoods[0].image[r]=apiUrlPic+t.allGoods[0].image[r];var a=i("order-box-tpl",t);document.getElementById("order-box").innerHTML=a,e.getMsg(apiUrl+"/front/logistics/logistic/getListLogistics").done(function(t){t=t.list;var e="",o=t[0].price/100,i=n(h,o);$("#freight-money").text(o),$("#total-money").text(i);for(var r=0;r<t.length;r++)t[r].price=t[r].price/100,e+="<option price="+t[r].price+' value="'+t[r].logisticsId+'">'+t[r].name+"</option>";$("#logistics-list").html(e),l(),s()})}else 416==o?(sessionStorage.lastLink="/pages/bdshop/page/submit_order.html?id="+d,$.toast("请绑定手机号","text",function(){location.href="/pages/bdshop/page/login.html"})):console.log("获取数据失败")})}function s(){var t=$("#address-more"),o="";$("#submit-btn").click(function(){if(602==p)return void $.toast("请填写收货地址","text");o=t.attr("rid");var i=apiUrl+"/front/order/order/addOrder",r=$("#logistics-list").val(),a=$("#freight-money").text(),s={receiveId:o,logisticsId:r,"orderDetailsList[0].goodsId":d,"orderDetailsList[0].goodsName":g,"orderDetailsList[0].price":100*h,"orderDetailsList[0].num":"1",logisticsPrice:100*a};e.getMsg(i,s,"post").done(function(t){var e=t.res;1==e&&(window.location.href="/pages/bdshop/page/pay_check.html?orderNumber="+t.result+"&price="+$("#total-money").text())})})}function l(){$("#logistics-list").change(function(){var t=$(this),e=t.val(),o="";t.children().each(function(){$(this).attr("value")==e&&(o=$(this).attr("price"))}),$("#freight-money").text(o);var i=n(o,h);$("#total-money").text(i)})}function n(t,e){var o,i,r;try{o=t.toString().split(".")[1].length}catch(a){o=0}try{i=e.toString().split(".")[1].length}catch(a){i=0}return r=Math.pow(10,Math.max(o,i)),(c(t,r)+c(e,r))/r}function c(t,e){var o=0,i=t.toString(),r=e.toString();try{o+=i.split(".")[1].length}catch(a){}try{o+=r.split(".")[1].length}catch(a){}return Number(i.replace(".",""))*Number(r.replace(".",""))/Math.pow(10,o)}var d=e.GetQueryString("id"),g="",p="",h="";a()});