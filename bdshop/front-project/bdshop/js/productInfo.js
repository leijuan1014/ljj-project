define(["jquery","components","common","template",,"swiper"],function(e,t,o,n,i){function s(e){var o=apiUrl+"/front/goods/goods/getPageFrontByGoodsId?goodsId="+e;t.getMsg(o).done(function(e){var t=e.res;if(1==t){var o=e.obj;e.goodsDataList=o;for(var i=0;i<e.goodsDataList.length;i++){if(""!==e.goodsDataList[i].image){e.goodsDataList[i].image=e.goodsDataList[i].image.split(",");for(var s=0;s<e.goodsDataList[i].image.length;s++)e.goodsDataList[i].image[s]=apiUrlPic+e.goodsDataList[i].image[s]}e.goodsDataList[i].vo_retailPrice=e.goodsDataList[i].vo_retailPrice/100}var d=n("show_goods_list-tpl",e);$("#show_goods_list").html(d);for(var a in o){var r=new Object;r="goodsId_"+o[a].goodsId,$("#"+r).click(function(){g(this.id.substring(8))}),$("#one_edit_"+o[a].vo_priceId).val(o[a].vo_shoppingCartNum),$("#one_sub_"+o[a].vo_priceId).click(function(){l(2,this.id.substring(8))}),$("#one_add_"+o[a].vo_priceId).click(function(){l(1,this.id.substring(8))}),$("#one_edit_"+o[a].vo_priceId).change(function(){l(3,this.id.substring(9))}),1==o[a].vo_countGoodsPrice&&(document.getElementById("goodsId_"+o[a].goodsId).style.display="none",0==o[a].vo_shoppingCartNum?document.getElementById("one_add_"+o[a].vo_priceId).style.display="block":(document.getElementById("one_sub_"+o[a].vo_priceId).style.display="block",document.getElementById("one_edit_"+o[a].vo_priceId).style.display="block",document.getElementById("one_add_"+o[a].vo_priceId).style.display="block")),1==o[a].delState?(document.getElementById("img_true_"+o[a].goodsId).style.display="block",document.getElementById("img_false_"+o[a].goodsId).style.display="none"):(document.getElementById("img_true_"+o[a].goodsId).style.display="none",document.getElementById("img_false_"+o[a].goodsId).style.display="block"),$("#img_true_"+o[a].goodsId).click(function(){y(-1,this.id.substring(9))}),$("#img_false_"+o[a].goodsId).click(function(){y(1,this.id.substring(10))})}new Swiper(".swiper-container",{autoplay:3e3});p()}else alert("获取商品失败！")})}function d(e,o,n){if(1!=_){_=!0;var i="one_edit_"+o,s="one_sub_"+o;1==n&&(i="edit_"+o,s="sub_"+o);var d=$("#"+i).val();d=parseInt(d),(isNaN(d)||d<0)&&(d=0),1==e?d=parseInt(d)+parseInt(1):2==e&&(d=parseInt(d)-parseInt(1)),d>1e4&&(d=1e4);var l=apiUrl+"/front/shoppingcart/shoppingcart/editNumeberToShoppingCart?priceId="+o+"&quantity="+d;t.getMsg(l).done(function(e){_=!1,u();var t=e.res;1==t?(0==d?(document.getElementById(s).style.display="none",document.getElementById(i).style.display="none"):(document.getElementById(s).style.display="block",document.getElementById(i).style.display="block"),$("#"+i).val(d)):alert("直接修改数量操作失败！")})}}function l(e,t){d(e,t,0)}function a(e){d(2,e,1)}function r(e){d(1,e,1)}function c(e){d(3,e,1)}function g(e){var o="show_goods_price_list_"+e,i=document.getElementById(o).style.display;if("none"==i){var s=apiUrl+"/front/goodsPrice/goodsPrice/getGoodsPriceListByGoodsId?goodsId="+e;t.getMsg(s).done(function(t){var i=t.res;if(1==i){for(var s=t.obj,d=0;d<s.length;d++)s[d].retailPrice=s[d].retailPrice/100;t.goodspriceDataList=s;var l=n("show_goods_price_list-tpl",t);$("#"+o).html(l);var g="goodsId_"+e;document.getElementById(g).innerHTML="收起",document.getElementById(o).style.display="";for(var u in s){var m=new Object;m=s[u].priceId,$("#edit_"+m).val(s[u].buyPrice),$("#sub_"+m).click(function(){a(this.id.substring(4))}),$("#add_"+m).click(function(){r(this.id.substring(4))}),$("#edit_"+m).change(function(){c(this.id.substring(5))}),0==s[u].buyPrice&&(document.getElementById("sub_"+m).style.display="none",document.getElementById("edit_"+m).style.display="none")}}else alert("获取产品规格失败！")})}else{document.getElementById(o).style.display="none";var d="goodsId_"+e;document.getElementById(d).innerHTML="选择规格"}}function u(){var e=apiUrl+"/front/shoppingcart/shoppingcart/queryCurrentUserTotalPriceAndCategory";t.getMsg(e).done(function(e){var t=e.res;if(1==t){var o=e.obj;document.getElementById("totalNumber").innerHTML=o.totalPrice/100*1,document.getElementById("totalCategory").innerHTML=o.totalCategory,m()}else alert("获取总价失败！")})}function m(){var e=document.getElementById("totalNumber").innerHTML,t=(100*e-100*settleAccountsPrice)/100;t=parseFloat(t.toFixed(2)),t>=0?(document.getElementById("settle_accounts").innerHTML="结算",document.getElementById("settle_accounts").style.backgroundColor="#2CC17B",document.getElementById("settle_accounts").setAttribute("href","/pages/bdshop/page/order_submit.html")):(document.getElementById("settle_accounts").innerHTML="还差¥"+t*-1+"起送",document.getElementById("settle_accounts").removeAttribute("href"),document.getElementById("settle_accounts").style.backgroundColor="#C6C6C6")}function y(e,o){var n=apiUrl+"/front/storegoods/storegoods/addOrSubStoreGoods?goodsId="+o+"&state="+e;t.getMsg(n).done(function(t){var n=t.res;1==n?void 0!=e&&1==e?(document.getElementById("img_true_"+o).style.display="block",document.getElementById("img_false_"+o).style.display="none"):(document.getElementById("img_true_"+o).style.display="none",document.getElementById("img_false_"+o).style.display="block"):alert("操作失败！")})}function p(){$(".minus").click(function(){var e=$(this).siblings("input"),t=parseInt(e.val());1!==t&&(t-=1,e.val(t))}),$(".plus").click(function(){var e=$(this).siblings("input"),t=parseInt(e.val());t+=1,e.val(t)})}var _=!1;$("#shoppingCartDetail").on("click",function(){window.location.href="/pages/bdshop/page/myShoppingCart.html"});var I=t.GetQueryString("id");void 0!=I&&s(I),u()});