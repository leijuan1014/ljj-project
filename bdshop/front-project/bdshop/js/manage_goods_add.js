define(["jquery","template","components","ZeroClipboard","jqueryValidate","ueditorConfig","ueditorAll","manageCommon","bootstrap"],function(e,o,a,i,t,s,d,r,l){function n(){var e=!1,o=!1,i=!1,t=!1,s=!1,d=!1;a.getMsg(apiUrl+"/admin/module/module/queryModules").done(function(a){if(1==a.res)for(var r=a.obj,l=0;l<r.length;l++){var n=r[l],c=n.moduleId;n.parentId;7==c&&($("#goodsList").css("display","block"),e=!0),8==c&&($("#goodsOrder").css("display","block"),e=!0),9==c&&($("#goodsCatory").css("display","block"),e=!0),10==c&&($("#memberManage").css("display","block"),o=!0),11==c&&($("#messageManage").css("display","block"),o=!0),12==c&&($("#articleManage").css("display","block"),i=!0),13==c&&($("#adManage").css("display","block"),t=!0),14==c&&($("#goodsReport").css("display","block"),s=!0),15==c&&($("#orderReport").css("display","block"),s=!0),16==c&&($("#adminManage").css("display","block"),d=!0),17==c&&($("#roleManage").css("display","block"),d=!0),e&&$("#div1").css("display","block"),o&&$("#div2").css("display","block"),i&&$("#div3").css("display","block"),t&&$("#div4").css("display","block"),s&&$("#div5").css("display","block"),d&&$("#div6").css("display","block"),(e||o||i&&t||s||d)&&$(".container-wrap").css("display","block")}})}function c(){$("#div-box").on("change","#pic-upload",function(){var e=new FormData;e.append("param",""),e.append("file",$("#pic-upload")[0].files[0]);var o=apiUrl+"/upload/uploadimg/dydz/user";$.ajax({url:o,type:"POST",dataType:"json",data:e,processData:!1,contentType:!1,success:function(e){var o='<li picUrl="'+e.imageUrl+'"class="apply-book"> <img  src=" '+apiUrlPic+e.imageUrl+'"> <a docUrl="'+e.imageUrl+'" href="javascript:void(0)" class="text-basic del-doc"><i class="iconfont icon-delete"></i></a></li>';$("#pic-document-list").append(o),b+=1,6==b&&$(".a-upload").css("display","none")}})})}function p(){$("#div-box").on("click",".del-doc",function(){var e=$(this),o=apiUrl+"/upload/removeFile",a=e.attr("docUrl");$.ajax({url:o,type:"get",dataType:"json",data:"preImg="+a,success:function(o){1==o.res&&(e.parents("li").remove(),b-=1,b<6&&$(".a-upload").css("display","block"))}})})}function g(e){var i=apiUrl+"/admin/goods/goodsAdmin/getGoodsById?goodsId="+e;a.getMsg(i).done(function(i){var t=i.res;if(1==t){var s=o("div-box-tpl",i);if(document.getElementById("div-box").innerHTML=s,""!=i.obj.image){var d=i.obj.image.split(",");b=d.length,6==b&&$(".a-upload").css("display","none");for(var r=0;r<d.length;r++){var l=apiUrlPic+d[r];$("#pic-document-list").append($('<li picUrl="'+d[r]+'"class="apply-book"> <img  src=" '+l+'"> <a docUrl="'+d[r]+'" href="javascript:void(0)" class="text-basic del-doc"><i class="iconfont icon-delete"></i></a></li>'))}}U=$("#categoryId").val(),f(U);var n=apiUrl+"/admin/goodsPrice/goodsPriceAdmin/getGoodsPriceListByGoodsId?goodsId="+e;a.getMsg(n).done(function(e){var o=e.res;if(1==o)if(void 0==e.obj);else for(var a=e.obj,i=0;i<a.length;i++){var t=a[i],s=new Array;s[0]=t.priceId,s[1]=t.unitName,s[2]=t.buyPrice/100,s[3]=t.retailPrice/100,s[4]=t.wholesalePrice/100,s[5]="<a style='text-align:center;color:blue;cursor:pointer;' onclick='delRow(this);'>删除</a>";for(var d=document.getElementById("table").insertRow(1),r=0;r<s.length;r++)d.insertCell(r).innerHTML=s[r];d.cells[0].style.display="none"}}),I.ready(function(){I.setContent(i.obj.detailDescribe)})}})}function u(){$("#form-box").validate({rules:{goodsName:{required:!0,maxlength:20},recommend:{required:!0}},messages:{goodsName:{required:"商品名称必填",maxlength:"最多填写20个字符"},recommend:{required:"请选择一个"}},submitHandler:function(e){if(0==$("#categoryId").val())return void alert("请选择商品分类！");100*$("#price").val();$("#pic-document-list > li").each(function(){k+=$(this).attr("picUrl")+","});var o=/,$/gi;k=k.replace(o,"");var i=getAllTableData(),t=$("#form-box").serialize()+"&image="+k;t=void 0==i?t:t+"&goodspriceList="+JSON.stringify(i),a.getMsg(h,t,"post").done(function(e){1==e.res&&(a.Alert("success","修改成功"),setTimeout(function(){window.history.go(-1)},2e3))})}})}function v(e,i,t){var s=apiUrl+"/admin/productcategory/productcategory/getAllNormalChildCategoryByCategoryId?categoryId="+i;a.getMsg(s).done(function(a){var i=a.res;if(1==i){var s=a.obj;a.dataList=s;var d=o("levelCategoryDataList",a);d="firstLevelList"==e?'<option  value="0">一级分类</option>'+d:'<option  value="0">二级分类</option>'+d,$("#"+e).html(d),t&&$("#"+e).val(t)}})}function m(e){var o='<option  value="0">二级分类</option>';$("#secondLevelList").html(o),v("secondLevelList",e,0),$("#categoryId").val(e)}function y(e){if(0==e){var o=document.getElementById("firstLevelList"),a=o.options[o.selectedIndex].value;$("#categoryId").val(a)}else $("#categoryId").val(e)}function f(e){if(L){var o=apiUrl+"/admin/productcategory/productcategory/getProductCategoryInfo?categoryId="+e;a.getMsg(o).done(function(e){var o=e.res;if(1==o){var a=e.obj;0==a.parentId?v("firstLevelList",0,a.categoryId):(v("firstLevelList",0,a.parentId),v("secondLevelList",a.parentId,a.categoryId))}})}else v("firstLevelList",0,0);$("#firstLevelList").on("change",function(){var e=document.getElementById("firstLevelList"),o=e.options[e.selectedIndex].value;m(o)}),$("#secondLevelList").on("change",function(){var e=document.getElementById("secondLevelList"),o=e.options[e.selectedIndex].value;y(o)})}n(),window.ZeroClipboard=i;var b=0,I=UE.getEditor("container",{initialFrameWidth:800,initialFrameHeight:350}),L=a.GetQueryString("id"),h="",k="",U=0;L?(h=apiUrl+"/admin/goods/goodsAdmin/editGoods?goodsId="+L,g(L),$("#addState").text("编辑商品")):(h=apiUrl+"/admin/goods/goodsAdmin/addGoods",$("#addState").text("添加商品"),f()),c(),p(),u(),jQuery.validator.addMethod("num",function(e,o){var a=/^(([1-9]+\d*)|(\d+(\.\d[1-9]))|(\d+(\.[1-9])))$/g;return this.optional(o)||a.test(e)},"请填写非负正数且最多保留小数点后两位 ")});