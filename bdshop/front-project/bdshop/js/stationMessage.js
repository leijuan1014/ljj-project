define(["jquery","components","common","template"],function(e,a,i,t){function s(){a.getMsg(apiUrl+"/front/message/message/getMessageCount").done(function(e){var a=e.res;if(1==a){e.list;r=e.list[0]>0?e.list[0]:0,o=e.list[1]>0?e.list[1]:0}$("#noReadNarBtn").text("未读消息（"+o+"）"),$("#readNarBtn").text("已读消息（"+r+"）")})}function n(){$(".weui-tabbar a").removeClass("weui-bar__item_on"),$(".weui-tabbar a:eq(2)").addClass("weui-bar__item_on")}n();var o,r,d=2;s();var g=$("#msg-list"),l=$("#noRec"),u=$("#cloading"),c={page:0,size:15,isLoading:!1,url:apiUrl+"/front/message/message/getMessageByPage",getMore:function(e){c.isLoading||(e?(c.page=1,$("#noRec").hide(),g.html("")):c.page+=1,u.show(),c.isLoading=!0,setTimeout(c.d(c.page,c.size),1e3))},d:function(e,a){$.ajax({url:c.url,data:"pageNo="+e+"&pageSize="+a+"&state="+d,type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json"}).done(function(e){var a=e.res;if(0!==a){var i=e.obj.dataList;e=e.obj,i=e.dataList;var s=t("msg-list-tpl",e);i&&i.length>0?(c.isLoading=!1,l.hide()):(c.isLoading=!0,l.show()),c.page>1?g.append(s):g.html(s),u.hide()}else l.show(),u.hide()})}};$(window).scroll(function(){var e=$(document).scrollTop()+$(window).height()+100,a=$(document).height();e>=a&&c.getMore(!1)});var m=!1;m||(c.getMore(!1),m=!0),$("#noReadNar").click(function(){$(".weui-navbar a").siblings(".weui-tab__bd-item--active").removeClass("weui-tab__bd-item--active"),$(this).addClass("weui-tab__bd-item--active"),d=2,c.isLoading=!1,c.getMore(!0)}),$("#readedNar").click(function(){$(".weui-navbar a").siblings(".weui-tab__bd-item--active").removeClass("weui-tab__bd-item--active"),$(this).addClass("weui-tab__bd-item--active"),d=1,c.isLoading=!1,c.getMore(!0)}),$("#msg-list").on("click",".send-modal",function(){var e=$(this).attr("url"),a=$(this).attr("userMsgId"),i=$(this).attr("id");e.length>0?url=e:url="/pages/bdshop/page/stationMessageInfo.html?id="+i+"&userMessageId="+a,window.location.href=url})});