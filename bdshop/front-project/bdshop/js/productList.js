define(["jquery","components","common","template","hammer","updown"],function(t,e,o,s,n,a){function i(){var t=50+$("#footer_tabbar").height(),e=document.documentElement.clientHeight-t+2;$("#footer_tabbar")[0]?$("#right,#productClass").height(document.documentElement.clientHeight-45-50-55):$("#right,#productClass").height(e),$("#right,#productClass").css({right:0})}function d(t){var o=apiUrl+"/front/productCategory/productCategory/getAllNormalFirstLevelCategory";e.getMsg(o).done(function(e){var o=e.res;if(1==o){var n=e.obj;if(e.firstCategoryDataList=n,void 0!==n&&null!==n&&0!==n.length){var a=s("show_first_category-tpl",e);$("#show_first_category").html(a),$("#show_first_category").on("click","li[data-type]",function(){r($(this),$(this).attr("data-type"))}),t?r($("#show_first_category li[data-type='"+t+"']"),t):(t=n[0].categoryId?n[0].categoryId:"0",r($("#show_first_category li:eq(0)"),t))}else alert("没有一级分类！")}else alert("获取一级分类失败！")})}function r(t,o){t.siblings().removeClass("active"),t.addClass("active"),$("#right").scrollTop(0),$("#show_second_category").empty();var n=apiUrl+"/front/productCategory/productCategory/querySecondCategoryListByFirstCategoryId?categoryId="+o;e.getMsg(n).done(function(t){var e=t.res;if(1===e){var n=t.obj;t.secondCategoryDataList=n;var a={categoryId:o,parentId:o,categoryName:"全部",image:"",state:1,simpleDescribe:"全部"};if(n&&n.length>0){n.unshift(a);var i=s("show_second_category-tpl",t);$("#show_second_category").html(i),$("#show_second_category li[data-type]").click(function(){c($(this),$(this).attr("data-type"))}),c($("#show_second_category li:eq(0)"),$("#show_second_category li:eq(0)").attr("data-type"))}else{n=[],n.push(a),t.secondCategoryDataList=n;var i=s("show_second_category-tpl",t);$("#show_second_category").html(i),c($("#show_second_category li:eq(0)"),o)}}else alert("获取二级分类失败！")})}function c(t,e){$("#show_goods_list").empty(),t&&(t.siblings().removeClass("active"),t.addClass("active"),L.categoryId=e,b=0,L.unlock(),L.noData(!1),L.$domDown.html(L.opts.domDown.domLoad),L.loading=!0,L.opts.loadDownFn(L))}function l(t,o,s){if(1!=I){I=!0;var n="one_edit_"+o,a="one_sub_"+o;1==s&&(n="edit_"+o,a="sub_"+o);var i=$("#"+n).val();i=parseInt(i),(isNaN(i)||i<0)&&(i=0),1==t?i=parseInt(i)+parseInt(1):2==t&&(i=parseInt(i)-parseInt(1)),i>1e4&&(i=1e4);var d=apiUrl+"/front/shoppingcart/shoppingcart/editNumeberToShoppingCart?priceId="+o+"&quantity="+i;e.getMsg(d).done(function(t){I=!1,m();var e=t.res;1==e?(0==i?(document.getElementById(a).style.display="none",document.getElementById(n).style.display="none"):(document.getElementById(a).style.display="block",document.getElementById(n).style.display="block"),$("#"+n).val(i)):alert("直接修改数量操作失败！")})}}function g(t,e){l(t,e,0)}function u(t){l(2,t,1)}function y(t){l(1,t,1)}function p(t){l(3,t,1)}function _(t){var o="show_goods_price_list_"+t,n=document.getElementById(o).style.display;if("none"==n){var a=apiUrl+"/front/goodsPrice/goodsPrice/getGoodsPriceListByGoodsId?goodsId="+t;e.getMsg(a).done(function(e){var n=e.res;if(1==n){for(var a=e.obj,i=0;i<a.length;i++)a[i].retailPrice=a[i].retailPrice/100;e.goodspriceDataList=a;var d=s("show_goods_price_list-tpl",e);$("#"+o).html(d);var r="goodsId_"+t;document.getElementById(r).innerHTML="收起",document.getElementById(o).style.display="";for(var c in a){var l=new Object;l=a[c].priceId,$("#edit_"+l).val(a[c].buyPrice),$("#sub_"+l).click(function(){u(this.id.substring(4))}),$("#add_"+l).click(function(){y(this.id.substring(4))}),$("#edit_"+l).change(function(){p(this.id.substring(5))}),0==a[c].buyPrice&&(document.getElementById("sub_"+l).style.display="none",document.getElementById("edit_"+l).style.display="none")}}else alert("获取产品规格失败！")})}else{document.getElementById(o).style.display="none";var i="goodsId_"+t;document.getElementById(i).innerHTML="选择规格"}}function m(){var t=apiUrl+"/front/shoppingcart/shoppingcart/queryCurrentUserTotalPriceAndCategory";e.getMsg(t).done(function(t){var e=t.res;if(1==e){var o=t.obj;document.getElementById("totalNumber").innerHTML=o.totalPrice/100*1,document.getElementById("totalCategory").innerHTML=o.totalCategory,h()}else alert("获取总价失败！")})}function h(){var t=document.getElementById("totalNumber").innerHTML,e=(100*t-100*settleAccountsPrice)/100;e=parseFloat(e.toFixed(2)),parseInt(-e)===parseInt(settleAccountsPrice)?(document.getElementById("settle_accounts").innerHTML="¥"+settleAccountsPrice+"起送",document.getElementById("settle_accounts").removeAttribute("href"),document.getElementById("settle_accounts").style.backgroundColor="#CCC"):e>=0?(document.getElementById("settle_accounts").innerHTML="结算",document.getElementById("settle_accounts").style.backgroundColor="#2CC17B",document.getElementById("settle_accounts").setAttribute("href","/pages/bdshop/page/order_submit.html")):(document.getElementById("settle_accounts").innerHTML="还差¥"+e*-1+"起送",document.getElementById("settle_accounts").removeAttribute("href"),document.getElementById("settle_accounts").style.backgroundColor="#CCC")}e.addActiveClass(1),i();var I=!1,v=apiUrlPic,f=e.GetQueryString("categoryId"),b=0,C=5,L=$("#right").dropload({size:5,categoryId:"0",autoLoad:!1,loadUpFn:function(t){b=1,$.ajax({type:"GET",url:apiUrl+"/front/goods/goods/getPageFrontVOByGoodsCategory",data:"pageNo="+b+"&pageSize="+C+"&categoryId="+encodeURIComponent(t.categoryId),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){var o="",n=e.res,a=e.obj.dataList;if(e=e.obj,e.goodsDataList=a,1===n&&a.length>0){for(var i=0;i<e.goodsDataList.length;i++){if(""!==e.goodsDataList[i].image){e.goodsDataList[i].image=e.goodsDataList[i].image.split(",");for(var d=0;d<e.goodsDataList[i].image.length;d++)e.goodsDataList[i].image[d]=v+e.goodsDataList[i].image[d]}e.goodsDataList[i].vo_retailPrice=e.goodsDataList[i].vo_retailPrice/100}o=s("show_goods_list-tp1",e)}$("#show_goods_list").html(o),t.resetload(),t.unlock(),t.noData(!1);for(var r in a){var c=new Object;c="goodsId_"+a[r].goodsId,$("#"+c).click(function(){_(this.id.substring(8))}),$("#one_edit_"+a[r].vo_priceId).val(a[r].vo_shoppingCartNum),$("#one_sub_"+a[r].vo_priceId).click(function(){g(2,this.id.substring(8))}),$("#one_add_"+a[r].vo_priceId).click(function(){g(1,this.id.substring(8))}),$("#one_edit_"+a[r].vo_priceId).change(function(){g(3,this.id.substring(9))}),1==a[r].vo_countGoodsPrice&&(document.getElementById("goodsId_"+a[r].goodsId).style.display="none",0==a[r].vo_shoppingCartNum?document.getElementById("one_add_"+a[r].vo_priceId).style.display="block":(document.getElementById("one_sub_"+a[r].vo_priceId).style.display="block",document.getElementById("one_edit_"+a[r].vo_priceId).style.display="block",document.getElementById("one_add_"+a[r].vo_priceId).style.display="block"))}},error:function(e,o){t.resetload()}})},loadDownFn:function(t){b++;var e="";$.ajax({type:"GET",url:apiUrl+"/front/goods/goods/getPageFrontVOByGoodsCategory",data:"pageNo="+b+"&pageSize="+C+"&categoryId="+encodeURIComponent(t.categoryId),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(o){var n=o.res,a=o.obj.dataList;if(o=o.obj,o.goodsDataList=a,0!==n&&a.length>0){for(var i=0;i<o.goodsDataList.length;i++){if(""!==o.goodsDataList[i].image){o.goodsDataList[i].image=o.goodsDataList[i].image.split(",");for(var d=0;d<o.goodsDataList[i].image.length;d++)o.goodsDataList[i].image[d]=v+o.goodsDataList[i].image[d]}o.goodsDataList[i].vo_retailPrice=o.goodsDataList[i].vo_retailPrice/100}e=s("show_goods_list-tp1",o)}else t.lock();$("#show_goods_list").append(e),t.resetload();for(var r in a){var c="";c="goodsId_"+a[r].goodsId,$("#"+c).click(function(){_(this.id.substring(8))}),$("#one_edit_"+a[r].vo_priceId).val(a[r].vo_shoppingCartNum),$("#one_sub_"+a[r].vo_priceId).click(function(){g(2,this.id.substring(8))}),$("#one_add_"+a[r].vo_priceId).click(function(){g(1,this.id.substring(8))}),$("#one_edit_"+a[r].vo_priceId).change(function(){g(3,this.id.substring(9))}),1==a[r].vo_countGoodsPrice&&(document.getElementById("goodsId_"+a[r].goodsId).style.display="none",0==a[r].vo_shoppingCartNum?document.getElementById("one_add_"+a[r].vo_priceId).style.display="block":(document.getElementById("one_sub_"+a[r].vo_priceId).style.display="block",document.getElementById("one_edit_"+a[r].vo_priceId).style.display="block",document.getElementById("one_add_"+a[r].vo_priceId).style.display="block"))}},error:function(e,o){t.resetload()}})}});d(f),$("#searchText").on("click",function(){location.href="/pages/bdshop/page/productSearch.html"}),$("#shoppingCartDetail").on("click",function(){window.location.href="/pages/bdshop/page/myShoppingCart.html"}),m()});